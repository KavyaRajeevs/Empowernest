<div class="profile-container">
  <div class="profile-header">
    <h1>User Profile</h1>
    <button class="btn btn-outline-primary edit-btn" (click)="toggleEditMode()">
      {{ isEditMode ? 'Cancel' : 'Edit Profile' }}
    </button>
  </div>

  <div class="profile-content">
    <!-- Profile Image Section -->
    <div class="profile-image-section">
      <div class="image-container">
        <img 
          [src]="userProfile.imageUrl"  
          class="profile-image"
          (error)="onImageError($event)">
        
        <div class="image-overlay" *ngIf="isEditMode" (click)="fileInput.click()">
          <i class="fas fa-camera"></i>
          <span>Change Photo</span>
        </div>
        
        <input 
          #fileInput 
          type="file" 
          accept="image/*" 
          style="display: none"
          (change)="onImageSelect($event)">
      </div>
    </div>

    <!-- Profile Information -->
    <div class="profile-info">
      <form [formGroup]="profileForm" (ngSubmit)="saveProfile()">
        
        <!-- Name Field -->
        <div class="form-group">
          <label for="name" class="form-label">Full Name</label>
          <input 
            type="text" 
            class="form-control" 
            id="name" 
            formControlName="name"
            [readonly]="!isEditMode"
            [class.form-control-plaintext]="!isEditMode"
            [class.is-invalid]="profileForm.get('name')?.invalid && profileForm.get('name')?.touched">
          <div class="invalid-feedback" *ngIf="profileForm.get('name')?.invalid && profileForm.get('name')?.touched">
            Name is required and must be at least 2 characters long.
          </div>
        </div>

        <!-- Email Field (Read-only) -->
        <div class="form-group">
          <label for="email" class="form-label">Email</label>
          <input 
            type="email" 
            class="form-control-plaintext" 
            id="email" 
            [value]="userProfile.email"
            readonly>
          <small class="form-text text-muted">Email cannot be changed</small>
        </div>

        <!-- Age Field -->
        <div class="form-group">
          <label for="age" class="form-label">Age</label>
          <input 
            type="number" 
            class="form-control" 
            id="age" 
            formControlName="age"
            [readonly]="!isEditMode"
            [class.form-control-plaintext]="!isEditMode"
            [class.is-invalid]="profileForm.get('age')?.invalid && profileForm.get('age')?.touched"
            min="13" 
            max="120">
          <div class="invalid-feedback" *ngIf="profileForm.get('age')?.invalid && profileForm.get('age')?.touched">
            Age must be between 13 and 120.
          </div>
        </div>

        <!-- Role Field (Read-only) -->
        <div class="form-group">
          <label for="role" class="form-label">Role</label>
          <input 
            type="text" 
            class="form-control-plaintext" 
            id="role" 
            [value]="userProfile.role | titlecase"
            readonly>
        </div>

        <!-- Skills Field -->
        <div class="form-group">
          <label for="skills" class="form-label">Skills</label>
          <div *ngIf="!isEditMode" class="skills-display">
            <span 
              *ngFor="let skill of userProfile.skills" 
              class="badge bg-primary skill-badge">
              {{ skill }}
            </span>
            <span *ngIf="userProfile.skills.length === 0" class="text-muted">No skills added yet</span>
          </div>
          
          <div *ngIf="isEditMode" class="skills-edit">
            <div class="input-group mb-2">
              <input 
                type="text" 
                class="form-control" 
                [(ngModel)]="newSkill"
                [ngModelOptions]="{standalone: true}"
                placeholder="Add a skill..."
                (keyup.enter)="addSkill()">
              <button 
                class="btn btn-outline-secondary" 
                type="button" 
                (click)="addSkill()"
                [disabled]="!newSkill.trim()">
                Add
              </button>
            </div>
            
            <div class="current-skills">
              <span 
                *ngFor="let skill of userProfile.skills; let i = index" 
                class="badge bg-secondary skill-badge-edit">
                {{ skill }}
                <button 
                  type="button" 
                  class="btn-close btn-close-white ms-2" 
                  (click)="removeSkill(i)"
                  aria-label="Remove skill"></button>
              </span>
            </div>
          </div>
        </div>

        <!-- Image URL Field (for direct URL input) -->
        <div class="form-group" *ngIf="isEditMode">
          <label for="imageUrl" class="form-label">Profile Image URL (Optional)</label>
          <input 
            type="url" 
            class="form-control" 
            id="imageUrl" 
            formControlName="imageUrl"
            placeholder="https://example.com/image.jpg">
          <small class="form-text text-muted">
            You can either upload an image above or provide a direct URL here
          </small>
        </div>

        <!-- Action Buttons -->
        <div class="form-actions" *ngIf="isEditMode">
          <button 
            type="submit" 
            class="btn btn-primary"
            [disabled]="!profileForm.valid || isSaving">
            <span *ngIf="isSaving" class="spinner-border spinner-border-sm me-2"></span>
            {{ isSaving ? 'Saving...' : 'Save Changes' }}
          </button>
          <button 
            type="button" 
            class="btn btn-secondary ms-2"
            (click)="cancelEdit()">
            Cancel
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Profile Stats -->
  <div class="profile-stats mt-4">
    <div class="row">
      <div class="col-md-4">
        <div class="stat-card">
          <h3>{{ userProfile.skills.length }}</h3>
          <p>Skills</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="stat-card">
          <h3>{{ userProfile.role}}</h3>
          <p>Role</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="stat-card">
          <h3>{{ getProfileCompleteness() }}%</h3>
          <p>Profile Complete</p>
        </div>
      </div>
    </div>
  </div>
</div>
